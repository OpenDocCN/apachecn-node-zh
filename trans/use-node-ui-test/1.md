# 第一章。僵尸入门

> “僵尸. js 是一个轻量级框架，用于在模拟环境中测试客户端 JavaScript 代码。不需要浏览器。

这个定义来自 http://zombie.labnotes.org[的](http://zombie.labnotes.org)文档

web 应用程序的自动化测试对于拥有高质量的产品至关重要，但是正确地进行测试可能是一种痛苦的体验。这就是为什么项目的这一部分大部分时间都没有实现。开发人员要么将自己局限于孤立地测试底层业务逻辑和控制流，要么如果他们真的想要测试用户界面，就必须求助于复杂的设置，在这些设置中，您以某种方式连接到真实的浏览器，并使用远程脚本来命令它们。

僵尸. js 为这个场景提供了一个快速简单的替代方案，使您只需使用 JavaScript 就可以轻松快速地为您的 web 应用程序创建自动化测试。

本章涵盖的主题有:

*   软件测试简史
*   了解服务器端 DOM
*   僵尸. js 如何在内部工作

到本章结束时，您应该已经了解了僵尸. js 是如何工作的，以及可以使用它测试哪些类型的应用程序。

# 软件和用户界面测试简史

软件测试是收集某一产品或服务质量信息的必要活动。在传统的软件开发周期中，这项活动被委托给一个团队，这个团队唯一的工作就是发现软件中的问题。如果向国内最终用户销售通用产品，或者公司购买许可操作系统，则需要进行此类测试。

在大多数定制的软件中，测试团队负责手动测试软件，但通常客户必须进行验收测试，以确保软件按预期运行。

每当这些团队中有人发现软件中的新问题时，开发团队就必须修复软件，并再次将其放回测试循环中。这意味着每次发现错误时，交付软件最终版本所需的成本和时间都会增加。此外，在开发过程中发现问题越晚，对产品最终成本的影响就越大。

此外，软件交付的方式在过去几年也发生了变化；Web 使我们能够使软件的交付及其升级变得容易，缩短了从开发新功能到投入使用的时间。但是一旦你交付了产品的第一个版本，并且有几个客户在使用它，你就会面临一个困境；更新越少，意味着产品很快就会过时。另一方面，在软件中引入许多变化会增加出错和您的软件出错的机会，这可能会赶走客户。

关于一个开发过程如何减轻运送有缺陷的产品的风险，增加新功能按时交付的机会，以及整个产品达到一定的质量标准，有许多版本和迭代，但是所有参与构建软件的人都必须同意，越早发现错误越好。

这意味着您应该尽早发现问题，最好是在开发周期中。不幸的是，每次软件更改时，完全手工测试软件，成本会很高。这里的解决方案是自动化测试，以便最大化测试覆盖率(测试的应用程序代码的百分比和可能的输入变化)，并最小化运行每个测试所需的时间。如果您的测试只需要几秒钟就可以运行，那么每次您对代码库进行一次更改时，您都可以运行它们。

## 进入自动化时代

测试自动化已经存在好几年了，甚至在 Web 出现之前。一旦**图形用户界面** ( **图形用户界面**)开始成为主流，允许你针对图形用户界面记录、构建和运行自动化测试的工具就开始出现了。由于有许多语言和图形用户界面库用于构建应用程序，许多涵盖其中一些的工具开始出现。一般来说，它们允许您记录一个测试会话，您可以稍后自动重新创建。在这个会话中，您可以自动操作指针来点击事物(按钮、复选框、窗口上的位置等)，选择值(例如，从选择框中)，输入键盘操作并测试结果。

所有这些工具操作起来都相当复杂，最糟糕的是，它们大多数都是特定于技术的。

但是，如果你正在构建一个使用 HTML 和 JavaScript 的基于网络的应用程序，你有更好的选择。其中最著名的可能是 Selenium，它允许您记录、更改和运行针对所有主要浏览器的测试脚本。

您可以使用 Selenium 运行测试，但是您至少需要一个 Selenium 浏览器来连接自己，以便加载和运行测试。如果您使用尽可能多的浏览器运行测试，您将能够保证您的应用程序在所有浏览器中都能正常运行。但是，由于 Selenium 插入浏览器并命令它，在尽可能多的浏览器中运行一个相当复杂的应用程序的所有测试可能需要一些时间，您最不希望的是不要尽可能频繁地运行测试。

## 单元测试与集成测试

通常可以将自动化测试分为两类，即单元测试和集成测试。

*   **单元测试**:这些测试是你选择你的应用程序的一个小子集——比如一个类或者一个特定的对象——并且测试这个类或者对象提供给应用程序其余部分的接口。通过这种方式，您可以隔离特定的组件，并确保它的行为符合预期，以便应用程序中的其他组件可以安全地使用它。
*   **集成测试**:这些测试是将单个组件组合在一起，作为一个工作组进行测试。在这些测试中，您交互和操作用户界面，用户界面又与应用程序的底层块交互。你用僵尸工具做的测试就属于这一类。

## 什么是僵尸

僵尸. js 允许你在没有真正的网络浏览器的情况下运行这些测试。取而代之的是，它使用一个模拟的浏览器，在那里存储 HTML 代码并运行您可能在 HTML 页面中拥有的 JavaScript。这意味着不需要显示 HTML 页面，节省了宝贵的时间，否则这些时间会被渲染所占用。

然后，您可以使用僵尸. js 来引导这个模拟的浏览器加载页面，一旦页面被加载，就执行某些操作并观察结果。您可以使用 JavaScript 来完成这一切，而不必在您的客户端代码和您的测试脚本之间切换语言。

# 了解服务器端 DOM

僵尸. js 运行在 node . js([http://nodejs.org](http://nodejs.org))之上，这是一个平台，您可以使用 JavaScript 轻松构建网络服务器。它运行在谷歌的快速 V8 JavaScript 引擎之上，该引擎也为他们的 Chrome 浏览器提供动力。

### 注

在撰写本文时，V8 实现了 JavaScript ECMA 3 标准和 ECMA 5 标准的一部分。并非所有浏览器都平等地实现了所有版本的 JavaScript 标准的所有特性。这意味着，即使您的测试在僵尸. js 中通过，也不意味着它们将在所有目标浏览器中通过。

在 Node.js 之上，有一个名为 JSDOM([https://npmjs.org/package/jsdom](https://npmjs.org/package/jsdom))的第三方模块，允许您解析一个 HTML 文档，并在该文档的表示之上使用一个 API 这允许您查询和操作它。提供的应用编程接口是标准**文档对象模型** ( **DOM** )。

所有浏览器都实现了 DOM 标准的一个子集，这个子集是由 T2 万维网联盟(T4 W3C)内部的一个工作组作为一组建议指定的。他们有三个层次的建议。JSDOM 实现了这三者。

Web 应用程序直接或间接(通过使用 jQuery 等工具)使用这个浏览器提供的 DOM API 来查询和操作文档，使您能够创建具有复杂行为的浏览器应用程序。这意味着通过使用 JSDOM，您可以自动支持大多数现代浏览器支持的任何 JavaScript 库。

### 类型

**下载示例代码**

您可以从您在[http://www.packtpub.com](http://www.packtpub.com)的账户中下载您购买的所有 Packt 书籍的示例代码文件。如果您在其他地方购买了这本书，您可以访问[http://www.packtpub.com/](http://www.packtpub.com/)支持并注册，以便将文件直接通过电子邮件发送给您。

## 僵尸. js 是你的无头浏览器

在 Node.js 和之上是 JSDOM，僵尸. js .僵尸. js 提供了类似浏览器的功能和一个可以用来测试的 API。例如,僵尸网络的典型用法是打开浏览器，请求加载某个网址，填写表单上的一些值并提交，然后查询结果文档以查看是否存在成功消息。

为了使它更具体，这里有一个简单的例子，说明简单的僵尸. js 测试的代码可能是什么样子:

```
browser.visit('http://localhost:8080/form', function() {
  browser
    .fill('Name', 'Pedro Teixeira')
    .select('Born', '1975')
    .check('Agree with terms and conditions')
    .pressButton('Submit', function() {
      assert.equal(browser.location.pathname, '/success');
      assert.equal(browser.text('#message'),
        'Thank you for submitting this form!');
    });
});
```

这里你正在使用僵尸. js 的典型用法:加载一个包含表单的 HTML 页面；填写表格并提交；然后验证结果是否成功。

### 注

僵尸. js 不仅可以用于测试你的网络应用，还可以用于需要表现得像浏览器的应用，比如 HTML 刮刀、爬虫和各种 HTML 机器人。

如果你打算使用僵尸. js 来做这些活动，请做一个好的网络公民，并合乎道德地使用它。

# 总结

创建自动化测试是任何软件应用程序开发过程的重要部分。当使用 HTML、JavaScript 和 CSS 创建 web 应用程序时，可以使用僵尸. js 创建一组测试；这些测试加载、查询、操作并向任何给定的网页提供输入。

假设僵尸. js 模拟了一个浏览器，并且不依赖于 HTML 页面的实际呈现，那么测试运行的速度会比你测试一个真正的浏览器要快得多。因此，无论何时对应用程序进行任何小的更改，您都可以运行这些测试。

僵尸. js 运行在 Node.js 之上，使用 JSDOM 在任何 HTML 文档之上提供一个 DOM API，并使用一个简单的 API 模拟类似浏览器的功能，您可以使用这个 API 使用 JavaScript 创建您的测试。